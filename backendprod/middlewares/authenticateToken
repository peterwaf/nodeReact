import admin from "firebase-admin";
// use modular import instead of require
import serviceAccount from "../node-blog-94623-firebase-adminsdk-i60fn-382758f64e.json" assert { type: "json" };
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const authenticateToken = (req, res, next) => {
    const token = req.headers.authorization && req.headers.authorization.split(' ')[1];
    if (!token) return res.sendStatus(401); // Unauthorized

    admin.auth().verifyIdToken(token)
        .then((decodedToken) => {
            req.user = decodedToken; // You can access user details from decodedToken
            next(); // Proceed to the next middleware or route handler
        })
        .catch((error) => {
            console.error('Error verifying token:', error);
            res.sendStatus(403); // Forbidden
        });
};

export default authenticateToken